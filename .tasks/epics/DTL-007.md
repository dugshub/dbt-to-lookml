---
id: DTL-007
title: "Epic: Add configurable timezone conversion for LookML dimension_groups"
type: epic
status: refinement
labels:
  - stack:backend
  - type:epic
  - priority:high
created: 2025-11-12T20:00:00Z
updated: 2025-11-12T20:00:00Z
children:
  - DTL-008
  - DTL-009
  - DTL-010
  - DTL-011
  - DTL-012
  - DTL-013
---

# DTL-007: Epic: Add configurable timezone conversion for LookML dimension_groups

## Problem Statement

Currently, timezone conversion behavior in generated LookML is implicit, relying on Looker's default behavior (`convert_tz: yes`). This means timestamps are automatically converted from the database timezone to the user's viewing timezone. Users need explicit control over this behavior at multiple configuration levels (CLI flags, generator parameters, and per-dimension metadata) with a sensible default that prevents unexpected timezone conversions.

## Solution Approach

Implement a multi-level configuration system for timezone conversion:

1. **Schema Layer** - Add `convert_tz` support to the `Dimension` model's `_to_dimension_group_dict` method
2. **Generator Layer** - Add `convert_tz` parameter to `LookMLGenerator` with propagation to dimension generation
3. **CLI Layer** - Add `--convert-tz` / `--no-convert-tz` flags to the generate command
4. **Metadata Layer** - Support per-dimension override via `config.meta.convert_tz` in semantic model YAML

**Precedence (highest to lowest)**:
- Per-dimension metadata (`config.meta.convert_tz`)
- Generator parameter (`LookMLGenerator(convert_tz=...)`)
- CLI flag (`--convert-tz` / `--no-convert-tz`)
- Default (`convert_tz: no` - disable timezone conversion by default)

## Success Criteria

- âœ… CLI supports `--convert-tz` and `--no-convert-tz` flags
- âœ… `LookMLGenerator.__init__()` accepts `convert_tz: bool | None` parameter
- âœ… Dimensions can override via `config.meta.convert_tz: yes|no` in YAML
- âœ… Default behavior is `convert_tz: no` (explicit in generated LookML)
- âœ… Precedence chain works correctly (dimension meta > generator > CLI > default)
- âœ… All existing tests pass without modification
- âœ… New unit tests validate all configuration levels
- âœ… Golden files updated to reflect `convert_tz: no` in dimension_groups
- âœ… mypy strict typing maintained (no type errors)
- âœ… 95%+ branch coverage maintained

## Sub-Issues

- [DTL-008: Update Dimension schema to support convert_tz parameter](./../issues/DTL-008.md) - ðŸ“‹ Refinement
- [DTL-009: Update LookMLGenerator to accept and propagate convert_tz settings](./../issues/DTL-009.md) - ðŸ“‹ Refinement
- [DTL-010: Add CLI flags for timezone conversion control](./../issues/DTL-010.md) - ðŸ“‹ Refinement
- [DTL-011: Add comprehensive unit tests for timezone conversion](./../issues/DTL-011.md) - ðŸ“‹ Refinement
- [DTL-012: Update integration and golden tests](./../issues/DTL-012.md) - ðŸ“‹ Refinement
- [DTL-013: Update documentation for timezone conversion feature](./../issues/DTL-013.md) - ðŸ“‹ Refinement

## Links

- Plan: .tasks/plans/issue-plan-timezone-conversion-config.yaml

## History

### 2025-11-12 20:00 - Epic Created
Created from plan: .tasks/plans/issue-plan-timezone-conversion-config.yaml
