---
id: DTL-041
title: "Generate PoP global parameters"
type: feature
status: refinement
labels:
  - stack:backend
  - type:feature
  - priority:high
created: 2025-12-15T19:30:00Z
updated: 2025-12-15T19:30:00Z
parent: DTL-037
---

# DTL-041: Generate PoP global parameters

## Problem Statement

Generate LookML parameters for period window, grain, and comparison selection.

## What to Build

Three global parameters that control PoP behavior:

```lookml
# What's a "period"? (controls Prior Period offset)
parameter: period_window {
  label: "Period Window"
  type: unquoted
  allowed_value: { label: "Week", value: "week" }
  allowed_value: { label: "Month", value: "month" }
  allowed_value: { label: "Quarter", value: "quarter" }
  default_value: "month"
}

# Use date filter as-is, or override to to-date?
parameter: period_grain {
  label: "Reporting Grain"
  type: unquoted
  allowed_value: { label: "Selected Range", value: "selected" }
  allowed_value: { label: "MTD", value: "mtd" }
  allowed_value: { label: "YTD", value: "ytd" }
  default_value: "selected"
}

# Compare to what?
parameter: comparison_period {
  label: "Compare To"
  type: unquoted
  allowed_value: { label: "Prior Period", value: "pp" }
  allowed_value: { label: "Prior Year", value: "py" }
  default_value: "py"
}
```

### The Three PoP Dimensions

| Parameter | Config Field | Purpose | Used By |
|-----------|--------------|---------|---------|
| `period_window` | `windows` | What's a "period"? (week/month/quarter) | `is_prior_period` SQL offset |
| `period_grain` | `grains` | Use filter as-is or to-date? (selected/mtd/ytd) | Visible measure CASE |
| `comparison_period` | `comparisons` | Compare to what? (pp/py) | Visible measure CASE |

### period_grain Values

| Value | Label | Behavior |
|-------|-------|----------|
| `selected` | "Selected Range" | No override - use the date filter exactly as the user set it |
| `mtd` | "MTD" | Override to current month through today |
| `ytd` | "YTD" | Override to current year through today |

## Why It's Needed

Users need UI controls to:
1. Define what "Prior Period" means (week/month/quarter)
2. Choose whether to use date filter as-is or override to to-date (selected/mtd/ytd)
3. Choose comparison target (prior period vs prior year)

These parameters drive:
- The `{% parameter period_window %}` in `is_prior_period` dimension SQL
- The CASE statements in visible measures

## Technical Scope

- File: `src/dbt_to_lookml/generators/lookml.py`
- New method: `_generate_pop_parameters()`
- Generate `period_window` with allowed_values from `pop.windows` config
- Generate `period_grain` with allowed_values from `pop.grains` config
- Generate `comparison_period` with allowed_values from `pop.comparisons` config
- Add to view's parameters block

## Success Criteria

- [ ] `period_window` parameter generated with configured windows
- [ ] `period_grain` parameter generated with configured grains
- [ ] `comparison_period` parameter generated with configured comparisons
- [ ] Default values correctly set (month, full, py)
- [ ] Parameter placement in view output correct
- [ ] Only include allowed_values for configured options

## Links

- Epic: [DTL-037](./../epics/DTL-037.md)
- Strategy: [.tasks/strategies/DTL-041-strategy.md](./../strategies/DTL-041-strategy.md)
- Spec: [.tasks/specs/DTL-041-spec.md](./../specs/DTL-041-spec.md)

## History

### 2025-12-15 19:30 - Issue Created
Created from epic DTL-037
