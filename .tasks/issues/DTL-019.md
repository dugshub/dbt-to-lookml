---
id: DTL-019
title: "Add validation preview and confirmation step"
type: feature
status: ready
labels:
  - stack:backend
  - type:feature
  - priority:medium
  - state:spec-ready
created: 2025-11-12T20:50:00Z
updated: 2025-11-17T22:00:00Z
parent: DTL-014
---

# DTL-019: Add validation preview and confirmation step

## Problem Statement

Implement a preview step that shows what the command will do before execution, with confirmation prompt.

**Tasks**
- Create preview module showing parsed configuration
- Display: files to be processed, output location, key settings
- Count YAML files in input directory
- Estimate output files (views + explores + model)
- Show full command that will be executed
- Add confirmation prompt: "Execute command? [Y/n]"
- Support --yes flag to skip confirmation
- Add option to save command to shell history or file

**Acceptance Criteria**
- Preview shows rich-formatted summary panel
- File counts are accurate (input YAML files, estimated output files)
- Command is displayed with syntax highlighting
- Confirmation prompt is clear and defaults to No for safety
- User can abort without side effects
- Option to copy command instead of executing

**Preview Format**
```
╭─── Command Preview ────────────────────────────────────╮
│ Input:  semantic_models/ (5 YAML files)               │
│ Output: build/lookml/                                  │
│ Schema: production_analytics                           │
│                                                        │
│ Estimated output:                                      │
│   • 5 view files                                       │
│   • 1 explores file                                    │
│   • 1 model file                                       │
│                                                        │
│ Command:                                               │
│   dbt-to-lookml generate -i semantic_models/ \         │
│     -o build/lookml -s production_analytics            │
╰────────────────────────────────────────────────────────╯

Execute this command? [y/N]:
```

## Success Criteria

- [ ] Preview shows rich-formatted summary panel
- [ ] File counts are accurate
- [ ] Command displayed with syntax highlighting
- [ ] Confirmation prompt defaults to No
- [ ] User can abort without side effects
- [ ] Option to copy command instead of executing
- [ ] Tests passing

## Links

- Epic: [DTL-014](./../epics/DTL-014.md)
- Strategy: [.tasks/strategies/DTL-019-strategy.md](./../strategies/DTL-019-strategy.md)
- Spec: [.tasks/specs/DTL-019-spec.md](./../specs/DTL-019-spec.md)

## History

### 2025-11-17 22:00 - Spec Generated
Comprehensive implementation specification created:
- **Spec file**: `.tasks/specs/DTL-019-spec.md`
- **Status**: ready → Implementation can begin
- **Test coverage**: 19 unit tests + 3 CLI integration tests defined
- **Estimated time**: 3 hours (6 phases)
- **Key components**:
  - PreviewData dataclass structure
  - CommandPreview class with Rich panel design
  - Utility functions (count_yaml_files, estimate_output_files, format_command_parts)
  - show_preview_and_confirm() orchestration function
  - CLI integration with --yes and --preview flags
  - Rich syntax highlighting for command display

### 2025-11-12 20:50 - Issue Created
Created from epic DTL-014
