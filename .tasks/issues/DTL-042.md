---
id: DTL-042
title: "Generate hidden PoP measures"
type: feature
status: refinement
labels:
  - stack:backend
  - type:feature
  - priority:high
created: 2025-12-15T19:30:00Z
updated: 2025-12-15T19:30:00Z
parent: DTL-037
---

# DTL-042: Generate hidden PoP measures

## Problem Statement

Generate hidden measures for each grain x comparison combination.

## What to Build

For each pop-enabled measure, generate hidden measures filtered by PoP dimensions:
- `{measure}_measure`: Base measure (current period, full)
- `{measure}_mtd_measure`: MTD filtered
- `{measure}_ytd_measure`: YTD filtered
- `{measure}_pp_measure`: Prior period filtered
- `{measure}_py_measure`: Prior year filtered
- Combined: `{measure}_mtd_pp_measure`, `{measure}_mtd_py_measure`, etc.

## Example Output

```lookml
# Base measure (current period, no filter)
measure: revenue_measure {
  hidden: yes
  type: sum
  sql: ${TABLE}.checkout_amount ;;
}

# Grain variants
measure: revenue_mtd_measure {
  hidden: yes
  type: sum
  sql: ${TABLE}.checkout_amount ;;
  filters: [is_mtd: "yes"]
}

measure: revenue_ytd_measure {
  hidden: yes
  type: sum
  sql: ${TABLE}.checkout_amount ;;
  filters: [is_ytd: "yes"]
}

# Comparison variants
measure: revenue_pp_measure {
  hidden: yes
  type: sum
  sql: ${TABLE}.checkout_amount ;;
  filters: [is_prior_period: "yes"]
}

measure: revenue_py_measure {
  hidden: yes
  type: sum
  sql: ${TABLE}.checkout_amount ;;
  filters: [is_prior_year: "yes"]
}

# Combined grain x comparison variants
measure: revenue_mtd_py_measure {
  hidden: yes
  type: sum
  sql: ${TABLE}.checkout_amount ;;
  filters: [is_mtd_prior_year: "yes"]
}
```

### Measure Count per Metric

For full config (grains: [mtd, ytd], comparisons: [pp, py]):
- 1 base measure
- 2 grain measures (mtd, ytd)
- 2 comparison measures (pp, py)
- 4 combined measures (mtd_pp, mtd_py, ytd_pp, ytd_py)
- **Total: 9 hidden measures**

## Why It's Needed

Hidden measures provide the pre-filtered aggregations that visible measures
reference via CASE statements. This pattern allows single-query execution
with parameter-driven display.

## Technical Scope

- File: `src/dbt_to_lookml/generators/lookml.py`
- New method: `_generate_pop_hidden_measures()`
- Only generate measures for configured grains/comparisons
- Preserve original measure aggregation type and SQL

## Success Criteria

- [ ] Hidden measure naming convention correct
- [ ] Filter application per grain/comparison works
- [ ] Measure count matches configured variants
- [ ] SQL and type preservation from source measure

## Links

- Epic: [DTL-037](./../epics/DTL-037.md)
- Strategy: [.tasks/strategies/DTL-042-strategy.md](./../strategies/DTL-042-strategy.md)
- Spec: [.tasks/specs/DTL-042-spec.md](./../specs/DTL-042-spec.md)

## History

### 2025-12-15 19:30 - Issue Created
Created from epic DTL-037
