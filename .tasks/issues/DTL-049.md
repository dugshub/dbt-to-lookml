---
id: DTL-049
title: "Implement time dimension detection for date selector"
type: feature
status: refinement
labels:
  - stack:backend
  - type:feature
  - layer:features
created: 2025-12-17T21:30:00Z
updated: 2025-12-17T21:30:00Z
parent: DTL-046
---

# DTL-049: Implement time dimension detection for date selector

## Problem Statement

Create logic to detect time dimensions from semantic models based on mode settings.

## Implementation Details

- Add `_get_date_selector_dimensions(model: SemanticModel)` method to generator
- Filter dimensions where `type == DimensionType.TIME`
- Apply mode-based filtering:
  - **Auto mode**: Include all time dims EXCEPT those with `date_selector: false`
  - **Explicit mode**: Include ONLY dims with `date_selector: true`
- Extract: name, label, expr (SQL column), and whether it's the default
- Use `defaults.agg_time_dimension` to determine default selection
- Return list of time dimension info suitable for parameter generation

## Mode Logic

```python
def _should_include_in_date_selector(
    self, dim: Dimension, mode: str
) -> bool:
    """Determine if dimension should be in date selector."""
    date_selector_flag = None
    if dim.config and dim.config.meta:
        date_selector_flag = dim.config.meta.date_selector

    if mode == "auto":
        # Auto: include unless explicitly excluded
        return date_selector_flag is not False
    else:  # explicit
        # Explicit: only include if explicitly included
        return date_selector_flag is True
```

## Data Structure

```python
@dataclass
class TimeDimensionInfo:
    name: str           # e.g., "created_at"
    label: str          # e.g., "Rental Created"
    expr: str           # e.g., "rental_created_at_utc"
    is_default: bool    # True if matches agg_time_dimension
```

## Edge Cases

- No time dimensions after filtering: skip date selector generation
- Single time dimension: still generate (user can see available option)
- Missing label: use smart_title(name)
- Missing expr: use name as column
- All dims excluded: skip date selector (log warning)

## Success Criteria

- [ ] Implementation complete
- [ ] Tests passing
- [ ] Documentation updated

## Links

- Epic: [DTL-046](./../epics/DTL-046.md)
- Strategy: [.tasks/strategies/DTL-049-strategy.md](./../strategies/DTL-049-strategy.md)
- Spec: [.tasks/specs/DTL-049-spec.md](./../specs/DTL-049-spec.md)

## History

### 2025-12-17 21:30 - Issue Created
Created from epic DTL-046
