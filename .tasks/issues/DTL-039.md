---
id: DTL-039
title: "Parse pop meta from measures"
type: feature
status: refinement
labels:
  - stack:backend
  - type:feature
  - priority:high
created: 2025-12-15T19:30:00Z
updated: 2025-12-15T19:30:00Z
parent: DTL-037
---

# DTL-039: Parse pop meta from measures

## Problem Statement

Extend the dbt parser to extract PoP configuration from measure meta blocks.

## What to Build

- Parse `config.meta.pop` block from measure definitions
- Resolve model-level `pop.date_dimension` defaults
- Resolve `date_filter` (explicit or derived from `{date_dimension}_date`)
- Link PoP config to `defaults.agg_time_dimension` when no explicit date_dimension
- Track which measures have PoP enabled for downstream generation

### Resolution Order

**date_dimension:**
1. Measure-level `pop.date_dimension`
2. Model-level `config.meta.pop.date_dimension`
3. Model's `defaults.agg_time_dimension`

**date_filter:**
1. Measure-level `pop.date_filter`
2. Derive as `{resolved_date_dimension}_date`

## Why It's Needed

The parser must extract PoP configuration so the generator knows which measures
need PoP variants and what grains/comparisons to generate.

## Technical Scope

- File: `src/dbt_to_lookml/parsers/dbt.py`
- Extend measure parsing logic
- Add `pop_config` field to internal measure representation
- Handle missing/partial config gracefully

## Success Criteria

- [ ] Parse measures with full pop config
- [ ] Parse measures with partial config (uses defaults)
- [ ] Parse measures without pop (returns None)
- [ ] Model-level date_dimension inheritance works
- [ ] date_filter resolution works (explicit and derived)
- [ ] Falls back to defaults.agg_time_dimension when no date_dimension
- [ ] Tests pass for all parsing scenarios

## Links

- Epic: [DTL-037](./../epics/DTL-037.md)
- Strategy: [.tasks/strategies/DTL-039-strategy.md](./../strategies/DTL-039-strategy.md)
- Spec: [.tasks/specs/DTL-039-spec.md](./../specs/DTL-039-spec.md)

## History

### 2025-12-15 19:30 - Issue Created
Created from epic DTL-037
