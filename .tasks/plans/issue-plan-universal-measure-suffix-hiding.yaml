epic:
  title: "Epic: Universal Measure Suffix and Hiding Strategy"
  description: |
    Problem: Currently, measures from semantic models are generated in LookML with their original names, which can create naming collisions with user-facing metrics. This mixing of internal measures and external metrics violates the separation of concerns principle from the dbt semantic layer.

    Solution: Implement a universal naming convention where ALL semantic model measures get a `_measure` suffix and are marked as `hidden: yes`. Metrics that reference these measures will use the suffixed names, creating a clean separation.

    Benefits:
    - Clean separation between internal measures (hidden) and user-facing metrics (visible)
    - No collision detection logic needed
    - Aligns with dbt semantic layer philosophy (measures â†’ metrics)
    - Simple and maintainable

    Impact Areas:
    - schemas/semantic_layer.py: Measure.to_lookml_dict() method
    - generators/lookml.py: _resolve_measure_reference() method
    - Test files across unit/integration/golden test suites

    Sub-issues:
    - DTL-022: Modify Measure.to_lookml_dict() to add suffix and hidden property
    - DTL-023: Update LookMLGenerator._resolve_measure_reference() to append suffix
    - DTL-024: Update test expectations for measure generation
  labels:
    - type:epic
    - stack:backend
    - priority:medium
  status: Refinement
  children:
    - title: "Modify Measure.to_lookml_dict() to add suffix and hidden property"
      description: |
        Update the Measure class in schemas/semantic_layer.py to implement universal measure suffix and hiding:

        Changes needed:
        1. Modify line 555: Change name from `self.name` to `f"{self.name}_measure"`
        2. Add `"hidden": "yes"` to the result dictionary after the name field

        This ensures all measures generated from semantic models are:
        - Suffixed with `_measure` for clear identification
        - Marked as hidden to separate internal measures from user-facing metrics

        Technical scope:
        - File: src/dbt_to_lookml/schemas/semantic_layer.py
        - Method: Measure.to_lookml_dict() (lines 548-570)
        - Layer: Atoms (core data structure)

        Testing requirements:
        - Verify measure names include `_measure` suffix
        - Verify all measures have `hidden: yes` property
        - Maintain 95%+ branch coverage

        Parent: Epic - Universal Measure Suffix and Hiding Strategy
      labels:
        - type:feature
        - stack:backend
        - layer:atoms
        - priority:medium
      status: Refinement

    - title: "Update LookMLGenerator._resolve_measure_reference() to append suffix"
      description: |
        Modify _resolve_measure_reference() in generators/lookml.py to append `_measure` suffix to all measure references.

        Changes needed:
        1. Line 273 (same-view reference): Change from `${{{measure_name}}}` to `${{{measure_name}_measure}}`
        2. Line 277 (cross-view reference): Change from `${{{view_name}.{measure_name}}}` to `${{{view_name}.{measure_name}_measure}}`

        This ensures metrics correctly reference the suffixed measures created by Measure.to_lookml_dict().

        Technical scope:
        - File: src/dbt_to_lookml/generators/lookml.py
        - Method: _resolve_measure_reference() (lines 242-277)
        - Layer: Molecules (composition of atoms)

        Testing requirements:
        - Verify same-view references use suffixed names
        - Verify cross-view references use suffixed names
        - Test with simple, ratio, and derived metrics
        - Maintain 95%+ branch coverage

        Parent: Epic - Universal Measure Suffix and Hiding Strategy
      labels:
        - type:feature
        - stack:backend
        - layer:molecules
        - priority:medium
      status: Refinement

    - title: "Update test expectations for measure generation"
      description: |
        Update test files across all test suites to reflect the new measure suffix and hiding behavior.

        Test areas to update:
        1. Unit tests for Measure.to_lookml_dict():
           - Verify `_measure` suffix in generated names
           - Verify `hidden: yes` property present
           - Test with various measure configurations

        2. Unit tests for _resolve_measure_reference():
           - Verify same-view references include suffix
           - Verify cross-view references include suffix
           - Test error cases (measure not found)

        3. Integration tests:
           - Verify end-to-end measure generation with suffix
           - Verify metrics correctly reference suffixed measures
           - Test with multiple semantic models

        4. Golden tests:
           - Update expected LookML output files
           - Verify view files show hidden measures with suffix
           - Verify metric measures reference suffixed measures

        Technical scope:
        - Files: src/tests/unit/, src/tests/integration/, src/tests/test_golden.py
        - Layer: Features (testing the feature)

        Coverage requirements:
        - Maintain 95%+ branch coverage across all modules
        - All existing tests should pass with updated expectations

        Parent: Epic - Universal Measure Suffix and Hiding Strategy
      labels:
        - type:chore
        - stack:backend
        - layer:features
        - priority:medium
      status: Refinement
