epic:
  title: "Epic: Enhanced CLI with Rich wizard and improved UX"
  description: |
    **Problem Statement**
    The current CLI requires users to memorize all command flags and options upfront.
    There's no interactive guidance for building commands, making it challenging for new
    users to discover available options or understand best practices. Help text is basic
    and lacks examples or contextual suggestions.

    **Solution Approach**
    Implement a hybrid wizard system that provides:
    1. Enhanced help text with rich-formatted examples and usage patterns
    2. Contextual intelligence that detects project structure and suggests smart defaults
    3. Simple prompt-based wizard for quick command building
    4. Optional full TUI mode (Textual) for advanced interactive experience
    5. Validation preview to show what will happen before execution

    **Success Criteria**
    - Users can run `dbt-to-lookml wizard generate` to interactively build generate commands
    - Help text (`--help`) displays syntax-highlighted examples and common patterns
    - CLI auto-detects semantic_models directory and suggests appropriate defaults
    - Wizard shows validation preview before executing command
    - Optional `--wizard-tui` flag launches full TUI interface
    - All wizard functionality has comprehensive CLI tests (95%+ coverage)
    - Documentation updated with wizard usage examples

    **Sub-issues**
    1. DTL-014: Add wizard dependencies and base infrastructure
    2. DTL-015: Enhance help text with rich examples and formatting
    3. DTL-016: Implement contextual project detection and smart defaults
    4. DTL-017: Build simple prompt-based wizard for generate command
    5. DTL-018: Add validation preview and confirmation step
    6. DTL-019: Implement optional TUI wizard mode with Textual
    7. DTL-020: Integration, testing, and documentation
  labels:
    - stack:backend
    - type:epic
    - priority:medium
  status: Refinement
  children:
    - title: "Add wizard dependencies and base infrastructure"
      description: |
        Set up the foundational dependencies and module structure for the wizard system.

        **Tasks**
        - Add questionary/prompt_toolkit to pyproject.toml for prompt-based wizard
        - Add Textual library for optional TUI mode
        - Create new module: src/dbt_to_lookml/wizard/__init__.py
        - Create base wizard class with common functionality
        - Set up wizard command group in CLI

        **Acceptance Criteria**
        - Dependencies installed and locked in uv.lock
        - Wizard module structure created
        - Empty wizard command accessible: `dbt-to-lookml wizard --help`
        - Type hints and mypy validation passing

        **Technical Notes**
        - Use questionary for prompt-based UI (better than click.prompt)
        - Textual as optional dependency (graceful degradation if not installed)
        - Follow existing project structure patterns

        Parent: DTL-XXX (auto-set during creation)
      labels:
        - stack:backend
        - type:feature
        - priority:high
      status: Refinement

    - title: "Enhance help text with rich examples and formatting"
      description: |
        Improve the generate command help text with rich formatting, syntax-highlighted
        examples, and clear usage patterns.

        **Tasks**
        - Add Rich panels to structure help text sections
        - Create syntax-highlighted code examples for common patterns
        - Add table showing all options with descriptions and defaults
        - Include "Common Usage Patterns" section with 3-5 examples
        - Format error messages with better context using Rich

        **Acceptance Criteria**
        - `dbt-to-lookml generate --help` shows rich-formatted output
        - Examples section includes: basic usage, with prefixes, dry-run, timezone conversion
        - Options table clearly shows required vs optional flags
        - Help text fits in standard 80-column terminal
        - Error messages use Rich formatting consistently

        **Examples to Include**
        ```bash
        # Basic generation
        dbt-to-lookml generate -i semantic_models/ -o build/lookml -s prod_schema

        # With prefixes and dry-run
        dbt-to-lookml generate -i models/ -o lookml/ -s analytics \\
          --view-prefix "sm_" --explore-prefix "exp_" --dry-run

        # With timezone conversion
        dbt-to-lookml generate -i models/ -o lookml/ -s dwh --convert-tz
        ```

        Parent: DTL-XXX (auto-set during creation)
      labels:
        - stack:backend
        - type:feature
        - priority:medium
      status: Refinement

    - title: "Implement contextual project detection and smart defaults"
      description: |
        Add intelligence to detect project structure and suggest appropriate defaults
        for wizard prompts.

        **Tasks**
        - Create detection module: wizard/detection.py
        - Implement semantic model directory detection (common names: semantic_models/, models/, dbt_models/)
        - Detect existing LookML output directories
        - Extract schema names from existing YAML files if present
        - Provide smart defaults based on detected structure

        **Acceptance Criteria**
        - Detection finds semantic_models/ directory if it exists
        - Suggests schema name from first parsed YAML file
        - Detects build/lookml or lookml/ as likely output directories
        - Returns sensible defaults when detection fails
        - Detection is fast (<100ms) and doesn't parse all files

        **Technical Notes**
        - Use pathlib for cross-platform path handling
        - Implement caching to avoid repeated filesystem scans
        - Handle edge cases: multiple candidate directories, no YAML files
        - Follow project patterns from parser.py

        Parent: DTL-XXX (auto-set during creation)
      labels:
        - stack:backend
        - type:feature
        - priority:medium
      status: Refinement

    - title: "Build simple prompt-based wizard for generate command"
      description: |
        Implement interactive prompt-based wizard that guides users through building
        a generate command step by step.

        **Tasks**
        - Create wizard/generate_wizard.py module
        - Implement sequential prompts for all generate options
        - Use questionary for styled prompts with validation
        - Show contextual hints from detection module
        - Display defaults and descriptions for each prompt
        - Build final command string from answers
        - Add `dbt-to-lookml wizard generate` command

        **Acceptance Criteria**
        - Wizard prompts for all generate command options
        - Each prompt shows: description, default value, format hints
        - Input validation happens in real-time
        - Required fields (input-dir, output-dir, schema) are enforced
        - Optional fields can be skipped with Enter
        - Final command is displayed and copied to clipboard (if available)
        - User can edit any answer by going back

        **Prompt Sequence**
        1. Input directory (required, path validation, auto-detected default)
        2. Output directory (required, path validation, suggest based on input)
        3. Schema name (required, suggest from YAML if available)
        4. View prefix (optional, default: empty)
        5. Explore prefix (optional, default: empty)
        6. Connection name (optional, default: redshift_test)
        7. Model name (optional, default: semantic_model)
        8. Timezone conversion (yes/no, default: no)
        9. Additional options: dry-run, no-validation, show-summary (checkboxes)

        Parent: DTL-XXX (auto-set during creation)
      labels:
        - stack:backend
        - type:feature
        - priority:high
      status: Refinement

    - title: "Add validation preview and confirmation step"
      description: |
        Implement a preview step that shows what the command will do before execution,
        with confirmation prompt.

        **Tasks**
        - Create preview module showing parsed configuration
        - Display: files to be processed, output location, key settings
        - Count YAML files in input directory
        - Estimate output files (views + explores + model)
        - Show full command that will be executed
        - Add confirmation prompt: "Execute command? [Y/n]"
        - Support --yes flag to skip confirmation
        - Add option to save command to shell history or file

        **Acceptance Criteria**
        - Preview shows rich-formatted summary panel
        - File counts are accurate (input YAML files, estimated output files)
        - Command is displayed with syntax highlighting
        - Confirmation prompt is clear and defaults to No for safety
        - User can abort without side effects
        - Option to copy command instead of executing

        **Preview Format**
        ```
        ╭─── Command Preview ────────────────────────────────────╮
        │ Input:  semantic_models/ (5 YAML files)               │
        │ Output: build/lookml/                                  │
        │ Schema: production_analytics                           │
        │                                                        │
        │ Estimated output:                                      │
        │   • 5 view files                                       │
        │   • 1 explores file                                    │
        │   • 1 model file                                       │
        │                                                        │
        │ Command:                                               │
        │   dbt-to-lookml generate -i semantic_models/ \         │
        │     -o build/lookml -s production_analytics            │
        ╰────────────────────────────────────────────────────────╯

        Execute this command? [y/N]:
        ```

        Parent: DTL-XXX (auto-set during creation)
      labels:
        - stack:backend
        - type:feature
        - priority:medium
      status: Refinement

    - title: "Implement optional TUI wizard mode with Textual"
      description: |
        Create a full TUI (Text User Interface) mode using Textual library, providing
        a richer interactive experience with forms, navigation, and live preview.

        **Tasks**
        - Create wizard/tui.py module with Textual app
        - Implement form-based UI for all generate options
        - Add navigation: sections for required/optional/advanced settings
        - Create live preview panel that updates as user fills form
        - Add keyboard shortcuts for navigation and actions
        - Make TUI optional: graceful fallback if Textual not installed
        - Activate with `--wizard-tui` flag or `WIZARD_MODE=tui` env var

        **Acceptance Criteria**
        - TUI launches with `dbt-to-lookml wizard generate --wizard-tui`
        - Form sections: Required Fields, Optional Prefixes, Advanced Options
        - Live preview panel shows command and estimated output
        - Keyboard navigation: Tab, Shift+Tab, arrow keys, Enter to submit
        - Help text visible in sidebar with F1 key
        - TUI works in standard terminal (80x24 minimum)
        - Graceful error if Textual not installed: "Install textual for TUI mode"

        **UI Layout**
        ```
        ┌─ Generate Command Wizard ──────────────────────────┬─ Preview ─────┐
        │ Required Fields                                    │ Command:      │
        │   Input Directory:  [semantic_models/________]     │  dbt-to-      │
        │   Output Directory: [build/lookml/___________]     │  lookml...    │
        │   Schema Name:      [prod_analytics__________]     │               │
        │                                                    │ Output:       │
        │ Optional Prefixes                                  │  • 5 views    │
        │   View Prefix:   [_________________________]       │  • 1 explore  │
        │   Explore Prefix:[_________________________]       │               │
        │                                                    │               │
        │ Advanced Options                                   │               │
        │   ☐ Dry Run       ☐ Skip Validation               │               │
        │   ☐ Convert TZ    ☐ Show Summary                  │               │
        │                                                    │               │
        │         [Cancel]  [Preview]  [Execute]             │               │
        └────────────────────────────────────────────────────┴───────────────┘
        F1: Help  Tab: Next Field  Shift+Tab: Previous  Esc: Cancel
        ```

        Parent: DTL-XXX (auto-set during creation)
      labels:
        - stack:backend
        - type:feature
        - priority:low
      status: Refinement

    - title: "Integration, testing, and documentation"
      description: |
        Complete integration of wizard system with existing CLI, add comprehensive tests,
        and update documentation.

        **Tasks**
        - Write CLI tests for wizard command flows
        - Add unit tests for detection module
        - Create integration tests: prompt wizard, TUI wizard, preview
        - Mock user input in tests using questionary/click testing utilities
        - Update README.md with wizard usage examples
        - Add wizard section to CLAUDE.md with technical details
        - Ensure 95%+ branch coverage for all wizard code
        - Add CI test job specifically for wizard features

        **Acceptance Criteria**
        - All wizard features have unit tests
        - Integration tests cover full wizard flows
        - Tests mock user input and validate command generation
        - README includes "Interactive Wizard" section with examples
        - CLAUDE.md documents wizard architecture and testing approach
        - Coverage report shows 95%+ for wizard modules
        - CI pipeline passes with all wizard tests

        **Test Coverage Requirements**
        - wizard/detection.py: Test all detection scenarios
        - wizard/generate_wizard.py: Test prompt sequences, validation, command building
        - wizard/tui.py: Test form submission, navigation (may need Textual testing utilities)
        - Error handling: Test invalid inputs, missing files, permission errors

        **Documentation Updates**
        - README: Add "Interactive Wizard" section after "Usage" section
        - Show examples: basic wizard, TUI mode, preview-only mode
        - CLAUDE.md: Document wizard architecture, module structure, testing strategy

        Parent: DTL-XXX (auto-set during creation)
      labels:
        - stack:backend
        - type:chore
        - priority:high
        - tdd
      status: Refinement
