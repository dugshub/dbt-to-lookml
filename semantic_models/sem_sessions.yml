version: 2

semantic_models:
  - name: sessions
    description: |
      Semantic model for user sessions providing session-level metrics and
      dimensions.

      Based on the dim_user_sessions conforming layer model.
    
    model: ref('dim_user_sessions')
    
    # ========== Configuration ==========
    config:
      meta:
        domain: session
        owner: Analytics Team
        contains_pii: false
        update_frequency: real-time
    
    # ========== Defaults ==========
    defaults:
      agg_time_dimension: session_start
    
    # ========== Entities ==========
    entities:
      - name: session
        type: primary
        expr: session_sk
        description: Session surrogate key
      
      - name: user
        type: foreign
        expr: user_id
        description: User natural key (for non-rental contexts)
      
      - name: anonymous_user
        type: foreign
        expr: anonymous_id
        description: Anonymous user identifier
    
    # ========== Dimensions ==========
    dimensions:
      # Session Identifiers
      - name: session_id
        type: categorical
        expr: session_id
        description: Natural session identifier for user reference
        label: Session ID
      
      # Time Dimensions
      - name: session_start
        type: time
        type_params:
          time_granularity: day
        expr: session_starts_at
        description: Session start date
        label: Session Start
      
      - name: session_end
        type: time
        type_params:
          time_granularity: day
        expr: session_ends_at
        description: Session end date
        label: Session End
      
      - name: event_date
        type: time
        type_params:
          time_granularity: day
        expr: event_date
        description: Date of the session event
        label: Event Date
      
      # Platform & Device Dimensions
      - name: platform
        type: categorical
        expr: platform
        description: Platform used for the session
        label: Platform
      
      # User State Dimensions
      - name: is_logged_in
        type: categorical
        expr: is_logged_in
        description: Whether user was logged in during session
        label: Is Logged In
      
      - name: user_session_type
        type: categorical
        expr: user_session_type
        description: Type of user session
        label: User Session Type
      
      # Session Characteristics
      - name: session_length_bucket
        type: categorical
        expr: session_length_bucket
        description: Categorized session length
        label: Session Length Bucket
      
      # Marketing Dimensions
      - name: marketing_channel
        type: categorical
        expr: marketing_channel
        description: Marketing channel attribution
        label: Marketing Channel
      
      - name: utm_source
        type: categorical
        expr: utm_source
        description: UTM source parameter
        label: UTM Source
      
      - name: utm_medium
        type: categorical
        expr: utm_medium
        description: UTM medium parameter
        label: UTM Medium
      
      - name: utm_campaign
        type: categorical
        expr: utm_campaign
        description: UTM campaign parameter
        label: UTM Campaign
    
    # ========== Measures ==========
    measures:
      # Count Measures
      - name: session_count
        agg: count
        expr: session_id
        description: Count of sessions
        label: Session Count
        create_metric: true
      
      - name: unique_sessions
        agg: count_distinct
        expr: session_id
        description: Count of unique sessions
        label: Unique Sessions
        create_metric: true
      
      # User Count Measures
      - name: unique_users
        agg: count_distinct
        expr: user_id
        description: Count of unique registered users
        label: Unique Users
      
      - name: unique_anonymous_users
        agg: count_distinct
        expr: anonymous_id
        description: Count of unique anonymous users
        label: Unique Anonymous Users
      
      # Session Type Measures
      - name: logged_in_sessions
        agg: sum
        expr: case when is_logged_in = true then 1 else 0 end
        description: Count of sessions where user was logged in
        label: Logged In Sessions
        create_metric: true
      
      - name: anonymous_sessions
        agg: sum
        expr: case when user_id is null then 1 else 0 end
        description: Count of anonymous sessions
        label: Anonymous Sessions
      
      # Duration Measures
      - name: avg_session_length_minutes
        agg: average
        expr: session_length_minutes
        description: Average session length in minutes
        label: Avg Session Length (Min)
        create_metric: true
      
      - name: total_session_time_minutes
        agg: sum
        expr: session_length_minutes
        description: Total session time across all sessions in minutes
        label: Total Session Time (Min)
