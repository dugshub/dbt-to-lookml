version: 2

semantic_models:
  - name: reviews
    description: |
      Customer review fact semantic model sourced from `redshift_gold.fct_review`.
      Review-level data with star ratings, prompt sentiment, and category concern flags.

    model: ref('fct_review')
    defaults:
      agg_time_dimension: created_at

    entities:
      - name: review
        type: primary
        expr: review_id
      - name: rental
        type: foreign
        expr: unique_rental_sk
      - name: facility
        type: foreign
        expr: facility_sk

    dimensions:
      # ===== TIME DIMENSIONS =====
      - name: created_at
        label: "Review Created"
        description: "Timestamp when the review was submitted."
        type: time
        type_params:
          time_granularity: day
        expr: review_created_at
        config:
          meta:
            subject: "Date Dimensions"
            category: "Review Created (UTC)"
            hidden: true

      # ===== IDENTIFIERS =====
      - name: facility_id
        label: "Facility ID"
        description: "Facility being reviewed."
        type: categorical
        expr: facility_id
        config:
          meta:
            subject: "Identifiers"
            category: "Facility"
            bi_field: true

      # ===== ATTRIBUTES =====
      - name: star_rating
        label: "Star Rating"
        description: "Customer rating from 1-5 stars."
        type: categorical
        expr: star_rating
        config:
          meta:
            subject: "Customer Feedback"
            category: "Rating"
            bi_field: true

      - name: review_status
        label: "Review Status"
        description: "Review lifecycle status (submitted, moderated, published)."
        type: categorical
        expr: review_status
        config:
          meta:
            subject: "Customer Feedback"
            category: "Status"
            bi_field: true

      - name: review_device_source
        label: "Device Source"
        description: "Device used to submit review (ios, android, web)."
        type: categorical
        expr: review_device_source
        config:
          meta:
            subject: "Customer Feedback"
            category: "Device"
            bi_field: true

      # ===== FEEDBACK FLAGS =====
      - name: has_positive_feedback
        label: "Has Positive Feedback"
        description: "Review has at least one positive sentiment prompt."
        type: categorical
        expr: has_positive_feedback
        config:
          meta:
            subject: "Customer Feedback"
            category: "Sentiment"
            bi_field: true

      - name: has_negative_feedback
        label: "Has Negative Feedback"
        description: "Review has at least one negative sentiment prompt."
        type: categorical
        expr: has_negative_feedback
        config:
          meta:
            subject: "Customer Feedback"
            category: "Sentiment"
            bi_field: true

      # ===== CONCERN FLAGS =====
      - name: has_safety_concern
        label: "Has Safety Concern"
        description: "Review mentions safety concerns."
        type: categorical
        expr: has_safety_concern
        config:
          meta:
            subject: "Customer Feedback"
            category: "Concerns"
            bi_field: true

      - name: has_value_concern
        label: "Has Value Concern"
        description: "Review mentions value/pricing concerns."
        type: categorical
        expr: has_value_concern
        config:
          meta:
            subject: "Customer Feedback"
            category: "Concerns"
            bi_field: true

      - name: has_cleanliness_concern
        label: "Has Cleanliness Concern"
        description: "Review mentions cleanliness concerns."
        type: categorical
        expr: has_cleanliness_concern
        config:
          meta:
            subject: "Customer Feedback"
            category: "Concerns"
            bi_field: true

      - name: has_navigation_concern
        label: "Has Navigation Concern"
        description: "Review mentions navigation/wayfinding concerns."
        type: categorical
        expr: has_navigation_concern
        config:
          meta:
            subject: "Customer Feedback"
            category: "Concerns"
            bi_field: true

      - name: has_service_concern
        label: "Has Service Concern"
        description: "Review mentions service concerns."
        type: categorical
        expr: has_service_concern
        config:
          meta:
            subject: "Customer Feedback"
            category: "Concerns"
            bi_field: true

      - name: has_operations_concern
        label: "Has Operations Concern"
        description: "Review mentions operational issues."
        type: categorical
        expr: has_operations_concern
        config:
          meta:
            subject: "Customer Feedback"
            category: "Concerns"
            bi_field: true

    measures:
      - name: review_count
        label: "Review Count"
        description: "Count of reviews."
        agg: count
        expr: review_id
        config:
          meta:
            subject: "Reviews"
            category: "Metrics"
            hidden: true

      - name: average_star_rating
        label: "Average Star Rating"
        description: "Average star rating (1-5 scale)."
        agg: average
        expr: star_rating
        config:
          meta:
            subject: "Reviews"
            category: "Metrics"
            hidden: true

      - name: total_positive_prompts
        label: "Total Positive Prompts"
        description: "Sum of positive prompts selected."
        agg: sum
        expr: count_positive_prompts
        config:
          meta:
            subject: "Reviews"
            category: "Metrics"
            hidden: true

      - name: total_negative_prompts
        label: "Total Negative Prompts"
        description: "Sum of negative prompts selected."
        agg: sum
        expr: count_negative_prompts
        config:
          meta:
            subject: "Reviews"
            category: "Metrics"
            hidden: true
