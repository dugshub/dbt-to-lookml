version: 2

metrics:
  # ===== BASE METRICS =====

  - name: facility_transition_count
    label: "Facility Transitions"
    description: |
      Count of facility state transitions.
      Filter by transition_type dimension for specific transitions (gained, lost, etc.).
    type: simple
    type_params:
      measure: transition_count
    config:
      meta:
        subject: "Facilities"
        category: "Lifecycle"
        bi_field: true
        primary_entity: facility_lifecycle_transition

  - name: facility_count
    label: "Facility Count"
    description: |
      Distinct count of facilities.
      WARNING: Without is_current=true filter, includes all historical states.
      For current counts, filter: is_current=true
      For healthy facilities, also add: is_on_and_active=true
    type: simple
    type_params:
      measure: facility_count
    config:
      meta:
        subject: "Facilities"
        category: "Lifecycle"
        bi_field: true
        primary_entity: facility_lifecycle_transition

  # ===== CONVENIENCE METRIC =====

  - name: current_healthy_facility_count
    label: "Current Healthy Facilities"
    description: |
      Count of facilities currently ON and ACTIVE.
      Pre-filtered convenience metric - no additional filters needed.
    type: simple
    type_params:
      measure: facility_count
    filter:
      - "{{ Dimension('facility_lifecycle__is_current') }} = true"
      - "{{ Dimension('facility_lifecycle__is_on_and_active') }} = true"
    config:
      meta:
        subject: "Facilities"
        category: "Lifecycle"
        bi_field: true
        primary_entity: facility_lifecycle_transition
