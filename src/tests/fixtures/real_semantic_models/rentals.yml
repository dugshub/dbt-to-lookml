version: 2

semantic_models:
  - name: rentals
    description: Core rental fact semantic model sourced from `redshift_gold.fct_rental`.
    model: ref('fct_rental')
    defaults:
      agg_time_dimension: created_date
    entities:
      - name: rental
        type: primary
        expr: unique_rental_sk
      - name: rental_segmentation
        type: foreign
        expr: unique_rental_sk
      - name: facility
        type: foreign
        expr: facility_sk
      - name: search
        type: foreign
        expr: search_id
    dimensions:
      - name: created_date
        description: Date the rental was created.
        type: time
        type_params:
          time_granularity: day
        expr: rental_created_date
        config:
          meta:
            subject: "Universal"
            category: "Time Periods"
            is_primary_time: true
      - name: payment_status
        description: Rental payment status category.
        type: categorical
        expr: rental_payment_status
        config:
          meta:
            subject: "Rentals"
            category: "Transaction Details"
      - name: reservation_status
        description: Rental reservation lifecycle status.
        type: categorical
        expr: rental_reservation_status
        config:
          meta:
            subject: "Rentals"
            category: "Transaction Details"
      - name: rental_starts_at
        description: When the parking period begins.
        type: time
        type_params:
          time_granularity: day
        expr: rental_starts_date_ut
        config:
          meta:
            subject: "Rentals"
            category: "Rental Details"
            is_primary_time: false
      - name: rental_ends_at
        description: When the parking period ends.
        type: time
        type_params:
          time_granularity: day
        expr: rental_ends_date
        config:
          meta:
            subject: "Rentals"
            category: "Rental Details"
            is_primary_time: false
      - name: rental_event_type
        description: Type of rental event.
        type: categorical
        expr: rental_event_type
        config:
          meta:
            subject: "Rentals"
            category: "Transaction Details"
    measures:
      - name: total_revenue
        description: Sum of rental checkout amounts in local currency.
        agg: sum
        expr: rental_checkout_amount_local
        config:
          meta:
            subject: "Rentals"
            category: "Revenue Metrics"
      - name: rentals
        description: Distinct rentals that occurred.
        agg: count_distinct
        expr: rental_id
        config:
          meta:
            subject: "Rentals"
            category: "Transaction Metrics"
      - name: renter_count
        description: Distinct renters who made rentals.
        agg: count_distinct
        expr: renter_id
        config:
          meta:
            subject: "Rentals"
            category: "Customer Metrics"
      - name: parking_spot_count
        description: Distinct facilities (parking spots) with rental activity. Note - counts only facilities with rentals, not all facilities.
        agg: count_distinct
        expr: facility_id
        config:
          meta:
            subject: "Rentals"
            category: "Facility Metrics"
      - name: average_rental_value
        description: Average revenue per rental (ARV).
        agg: average
        expr: rental_checkout_amount_local
        config:
          meta:
            subject: "Rentals"
            category: "Revenue Metrics"
      - name: revenue_25th_percentile
        description: 25th percentile of rental checkout amounts.
        agg: percentile
        agg_params:
          percentile: 0.25
        expr: rental_checkout_amount_local
        config:
          meta:
            subject: "Rentals"
            category: "Revenue Metrics"
      - name: revenue_50th_percentile
        description: Median rental checkout amount (50th percentile).
        agg: percentile
        agg_params:
          percentile: 0.50
        expr: rental_checkout_amount_local
        config:
          meta:
            subject: "Rentals"
            category: "Revenue Metrics"
      - name: revenue_75th_percentile
        description: 75th percentile of rental checkout amounts.
        agg: percentile
        agg_params:
          percentile: 0.75
        expr: rental_checkout_amount_local
        config:
          meta:
            subject: "Rentals"
            category: "Revenue Metrics"
      - name: average_lead_time_hours
        description: Average hours between booking and rental start.
        agg: average
        expr: lead_time_days * 24
        config:
          meta:
            subject: "Rentals"
            category: "Booking Metrics"
